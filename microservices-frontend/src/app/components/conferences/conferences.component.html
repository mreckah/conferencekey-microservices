<div class="container">
  <div class="header">
    <h2>Conferences</h2>
    <button class="btn btn-primary" (click)="openAddModal()">
      <span class="icon">+</span> Add Conference
    </button>
  </div>

  <div *ngIf="loading" class="loading">Loading conferences...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="!loading && !error" class="conferences-grid">
    <div *ngFor="let conference of conferences" class="conference-card">
      <div class="conference-header">
        <h3>{{ conference.titre }}</h3>
        <span class="type" [class.academique]="conference.type === 'ACADEMIQUE'"
              [class.commerciale]="conference.type === 'COMMERCIALE'">
          {{ conference.type }}
        </span>
      </div>
      <div class="conference-body">
        <p><strong>Date:</strong> {{ conference.date | date:'dd/MM/yyyy' }}</p>
        <p><strong>Dur√©e:</strong> {{ conference.duree }} minutes</p>
        <p><strong>Inscrits:</strong> {{ conference.nombreInscrits }}</p>
        <p><strong>Score:</strong> <span class="stars">{{ getStars(conference.score) }}</span> ({{ conference.score }})</p>
        <div *ngIf="conference.keynote" class="keynote-info">
          <p><strong>Keynote:</strong> {{ conference.keynote.prenom }} {{ conference.keynote.nom }}</p>
          <p class="fonction">{{ conference.keynote.fonction }}</p>
        </div>
        <div *ngIf="conference.reviews && conference.reviews.length > 0" class="reviews-count">
          <p>{{ conference.reviews.length }} review(s)</p>
        </div>
      </div>
      <div class="conference-actions">
        <button class="btn btn-edit" (click)="openEditModal(conference)">Edit</button>
        <button class="btn btn-delete" (click)="deleteConference(conference.id)">Delete</button>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && !error && conferences.length === 0" class="no-data">
    No conferences found.
  </div>
</div>

<!-- Add/Edit Modal -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ isEditMode ? 'Edit Conference' : 'Add Conference' }}</h3>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>
    <form (ngSubmit)="saveConference()" #conferenceForm="ngForm">
      <div class="form-group">
        <label for="titre">Title *</label>
        <input
          type="text"
          id="titre"
          name="titre"
          [(ngModel)]="currentConference.titre"
          required
          class="form-control">
      </div>
      <div class="form-group">
        <label for="type">Type *</label>
        <select
          id="type"
          name="type"
          [(ngModel)]="currentConference.type"
          required
          class="form-control">
          <option value="ACADEMIQUE">ACADEMIQUE</option>
          <option value="COMMERCIALE">COMMERCIALE</option>
        </select>
      </div>
      <div class="form-group">
        <label for="date">Date *</label>
        <input
          type="datetime-local"
          id="date"
          name="date"
          [(ngModel)]="conferenceDate"
          required
          class="form-control">
      </div>
      <div class="form-group">
        <label for="duree">Duration (minutes) *</label>
        <input
          type="number"
          id="duree"
          name="duree"
          [(ngModel)]="currentConference.duree"
          required
          min="1"
          class="form-control">
      </div>
      <div class="form-group">
        <label for="nombreInscrits">Number of Attendees *</label>
        <input
          type="number"
          id="nombreInscrits"
          name="nombreInscrits"
          [(ngModel)]="currentConference.nombreInscrits"
          required
          min="0"
          class="form-control">
      </div>
      <div class="form-group">
        <label for="score">Score (0-5) *</label>
        <input
          type="number"
          id="score"
          name="score"
          [(ngModel)]="currentConference.score"
          required
          min="0"
          max="5"
          step="0.1"
          class="form-control">
      </div>
      <div class="form-group">
        <label for="keynoteId">Keynote Speaker *</label>
        <select
          id="keynoteId"
          name="keynoteId"
          [(ngModel)]="currentConference.keynoteId"
          required
          class="form-control">
          <option value="">Select a keynote</option>
          <option *ngFor="let keynote of keynotes" [value]="keynote.id">
            {{ keynote.prenom }} {{ keynote.nom }} - {{ keynote.fonction }}
          </option>
        </select>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="!conferenceForm.form.valid">
          {{ isEditMode ? 'Update' : 'Create' }}
        </button>
      </div>
    </form>
  </div>
</div>

